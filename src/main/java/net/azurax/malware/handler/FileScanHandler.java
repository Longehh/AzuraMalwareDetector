package net.azurax.malware.handler;

import net.azurax.malware.api.check.IMalwareCheck;
import net.azurax.malware.api.handler.IScan;
import net.azurax.malware.result.Result;
import net.azurax.malware.ui.ScannerDisplay;

import java.io.File;
import java.util.List;

public class FileScanHandler implements IScan {
    private final ScannerDisplay display;
    private final List<IMalwareCheck> selectedChecks;
    private final File selectedFile;
    private final boolean directory;

    public FileScanHandler(ScannerDisplay display, List<IMalwareCheck> selectedChecks, File selectedFile, boolean directory) {
        this.display = display;
        this.selectedChecks = selectedChecks;
        this.selectedFile = selectedFile;
        this.directory = directory;
    }

    @Override
    public void startScan() {
        if(directory) {
            display.getResultArea().appendText("\nScanning File: " + selectedFile.getAbsolutePath() + "\n");
        } else {
            display.getResultArea().setText("Scanning File: " + selectedFile.getAbsolutePath() + "\n");
        }

        for (IMalwareCheck check : selectedChecks) {
            Result result = check.isMalware(selectedFile);
            display.getResultArea().appendText(check.getCheckName() + ": " + (result.isMalwareDetected() ? "❌ Failed" : "✅ Passed") + "\n");
            if (result.isMalwareDetected()) {
                display.getResultArea().appendText("  - Details: " + result.getResult() + "\n");
            }
        }
        if(!directory) {
            display.getResultArea().appendText("Scan Complete");
        }
    }
}
